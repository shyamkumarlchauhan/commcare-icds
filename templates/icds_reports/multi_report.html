{% extends "reports/tabular.html" %}
{% load hq_shared_tags %}
{% load report_tags %}
{% load i18n %}


{% block page_content %}
{% block reportcontent %}


{% block reporttable %}
{% if report.needs_filters %}
    {% include 'reports/partials/description.html' %}
{% else %}
    {% for provider in data_providers %}
        <div id="{{ provider.provider_slug }}">
        <br/>
        <br/>
        <br/>
            <h3 data-bind="visible: loading">Loading</h3>
            <h3 data-bind="visible: !loading">Hidden</h3>
            <h2 class="media-heading">{{ provider.title }}</h2><br/>
        <br/>
        <br/>
        </div>
    {% endfor %}
{% endif %}
{% endblock %}
{% block posttable %}{% endblock %}
{% endblock %}
{% endblock%}


{% block js-inline %} {{ block.super }}
<script>
    $(function () {
        var subReportModal = function(options){
            var self = {};

            self.providerSlug = options.providerSlug;
            self.loading = ko.observable(true);
            self.queryUrl = "{{ request.get_full_path }}";

            self.init = function(){
                $.ajax({
                    url: self.queryUrl + "&provider_slug=" + self.providerSlug,
                    success: function(data) {
                        var $element = $("#" + self.providerSlug);
                        $element.html(data.report);
                    }
                });
                // setTimeout(function(){
                //     $("#"+self.providerSlug).html("<h1>Got it!"+self.providerSlug+"<h1>");
                // }, 2000);
                // self.loading(false);
            };
            return self;
        };

        var dataProviders = hqImport("hqwebapp/js/initial_page_data").get("data_providers_json");
        for (var i = 0; i < dataProviders.length; i++) {
            var provider = dataProviders[i];
            var modal = subReportModal({
                    providerSlug: provider.provider_slug,
                });
            var element = document.getElementById(provider.provider_slug);
            if (element !== null) {
                // skip doing this on initial report load
                ko.applyBindings(
                    modal,
                    document.getElementById(provider.provider_slug)
                );
                modal.init();
            }
        }
    });
</script>
{% endblock %}