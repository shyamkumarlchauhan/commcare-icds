{% load compress %}{% load hq_shared_tags %}<!DOCTYPE html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
<script type="text/javascript" src="{% new_static 'jquery/dist/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% new_static 'style/lib/bootstrap-3.2.0/dist/js/bootstrap.min.js' %}"></script>
<script type="text/javascript" src="https://icds.commcarehq.org/javascripts/api/tableau-2.0.0.min.js "></script>

<script type="text/javascript" src="{% new_static 'underscore/underscore.js' %}"></script>


<div class="container-fluid">
    <div class="row">
        <div id="sideNav" class="col-md-3">
            <h2 class="text-center">Reports</h2>
        </div>
        <div class="col-md-9">
            {#    TODO: update this div to use B3 spacing that is the right size.#}
            <div id="tableauPlaceholder" style="width:1100px; height:900px;"></div>
        </div>
    </div>

</div>



<script>
    var viz = {}
    function initializeViz() {
        var placeholderDiv = document.getElementById("tableauPlaceholder");
        var url = "https://icds.commcarehq.org/#/views/DashboardReviewed/Dashboard";
        var options = {
            width: placeholderDiv.offsetWidth,
            height: placeholderDiv.offsetHeight,
            hideTabs: true,
            hideToolbar: true,
            onFirstInteractive: function () {
                setUpNav(viz)
            }
        };
        viz = new tableau.Viz(placeholderDiv, url, options);
    }

    function setUpNav(viz) {
        var workbook = viz.getWorkbook();
        var sheets = workbook.getPublishedSheetsInfo();
        _.each(sheets, function(sheet) {
            addNavigationButton(sheet.$0.name, sheet.$0.isActive)
        })
        $(".btn").click(function (){
            var btn = $(this);
            workbook.activateSheetAsync(btn[0].textContent);
            $(".btn.btn-success").removeClass('btn-success').addClass('btn-default');
            btn.removeClass('btn-default').addClass('btn-success');

        })
    }

    function addNavigationButton(sheetName, isActive) {
        var btnColor = isActive  ? 'success' : 'default';
        var html = "<div class='row'><button class='btn btn-block btn-" + btnColor + "'>" + sheetName + "</btn></div>";
        $("#sideNav").append(html);
    }

    initializeViz()





</script>
