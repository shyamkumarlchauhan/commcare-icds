DELETE FROM "icds_dashboard_ccs_record_delivery_forms" WHERE month=%(month)s AND state_id = %(state)s
{"month": "2019-01-01", "state": "st1"}

        INSERT INTO "icds_dashboard_ccs_record_delivery_forms" (
          case_id, state_id, supervisor_id, month, latest_time_end_processed,
          breastfed_at_birth, breastfed_at_birth_original_status, valid_visits, where_born, num_children_del,
          still_live_birth
        ) (
          SELECT
            DISTINCT ucr.case_load_ccs_record0 AS case_id,
            %(state_id)s AS state_id,
            LAST_VALUE(ucr.supervisor_id) over w as supervisor_id,
            %(month)s::DATE AS month,
            LAST_VALUE(ucr.timeend_with_time) over w AS latest_time_end_processed,
            LAST_VALUE(ucr.breastfed_at_birth) over w as breastfed_at_birth,
            COALESCE(LAST_VALUE(ucr.breastfed_at_birth) over w , prev_month.breastfed_at_birth) as breastfed_at_birth_original_status,
            SUM(CASE WHEN (ucr.unscheduled_visit=0 AND ucr.days_visit_late < 8) OR
                          (ucr.timeend_with_time::DATE - ucr.next_visit) < 8 THEN 1 ELSE 0 END
                ) OVER w as valid_visits,
            COALESCE(LAST_VALUE(ucr.where_born) OVER w, prev_month.where_born) AS where_born,
            COALESCE(LAST_VALUE(ucr.num_children_del) OVER w, prev_month.num_children_del) AS num_children_del,
            COALESCE(LAST_VALUE(ucr.still_live_birth) OVER w, prev_month.still_live_birth) AS still_live_birth
          FROM "ucr_icds-cas_static-dashboard_delivery_fo_f079e6e1" ucr
          LEFT OUTER JOIN (
            SELECT * FROM "ucr_icds-cas_static-dashboard_delivery_fo_f079e6e1" where timeend_with_time >= %(prev_month_start)s and timeend_with_time < %(current_month_start)s
          ) prev_month ON ucr.supervisor_id = prev_month.supervisor_id AND
          ucr.case_load_ccs_record0 = prev_month.case_load_ccs_record0
          WHERE ucr.state_id = %(state_id)s AND
                ucr.timeend_with_time >= %(current_month_start)s AND ucr.timeend_with_time < %(next_month_start)s AND
                ucr.case_load_ccs_record0 IS NOT NULL
          WINDOW w AS (
            PARTITION BY ucr.supervisor_id, ucr.case_load_ccs_record0
            ORDER BY ucr.timeend_with_time RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
          )
        )
        
{"current_month_start": "2019-01-01", "month": "2019-01-01", "next_month_start": "2019-02-01", "prev_month_start": "2018-12-01", "state_id": "st1"}